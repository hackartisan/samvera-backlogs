Fixity in our app
Backported code that I previously contributed to Hyrax. May handle #276? The backport was a bit messy. I tried a new way to organize this code -- a folder at ./app/patches, that can have subdirs, which have a README describing what they're doing, and include files needed for one conceptual patch or backport.  Added Dir.glob(Rails.root.join("patches/*")) to Rails autoload_paths to accomplish this. This code organization definitely doesn't completely eliminate the pain of dealing with this in the future as we upgrade our dependencies, but it's the best I could come up with. What this actually does: Every day at 2:30am, a fixity check rake task is run.  While it runs every day, it currently is set to accept up to 7-day-old existing fixity checks, so won't always re-check everything. (configurable) It is currently set to only check current versions, not all versions (configurable) It avoids using the ActiveJob queue, it just does everything in-process. (Note that if we scale out rails servers, we'll have to make sure these cronjobs scheduled by whenever are only run on one server, not every server)  If a fixity failure is found, it will send a notification to: email to digital-tech@chemheritage.org; and an in-message notification to anyone with admin role. The failure notifications are not pretty, they're kind of just a tech dump of all the relevant objects involved, meant for consumption by technical staff. I don't expect to get a fixity failure notification often. An example notification: Subject: FIXITY CHECK FAILURE: sample.jpg  hostname: macbook  Fixity check failure at 2017-05-23 15:28:28 UTC for: http://127.0.0.1:8080/rest/dev/bv/73/c0/41/bv73c041b/files/3183d6ac-1593-4765-95ed-9769de5bc938/fcr:versions/version1/fcr:metadata  Expected fixity result: urn:sha1:be79efcdd7562cef06a393de04188ca09cb21724  work: additional title tests 8049g504g /concern/generic_works/8049g504g  file_set: bv73c041b sample.jpg /concern/file_sets/8049g504g.bv73c041b http://127.0.0.1:8080/rest/dev/bv/73/c0/41/bv73c041b/fcr:metadata  file: bv73c041b/files/3183d6ac-1593-4765-95ed-9769de5bc938 http://127.0.0.1:8080/rest/dev/bv/73/c0/41/bv73c041b/files/3183d6ac-1593-4765-95ed-9769de5bc938/fcr:metadata  Logged in ChecksumAuditLog: #<ChecksumAuditLog id: 36, file_set_id: "bv73c041b", file_id: "bv73c041b/files/3183d6ac-1593-4765-95ed-9769de5bc9...", checked_uri: "http://127.0.0.1:8080/rest/dev/bv/73/c0/41/bv73c04...", passed: false, expected_result: "urn:sha1:be79efcdd7562cef06a393de04188ca09cb21724", actual_result: nil, created_at: "2017-05-23 15:28:28", updated_at: "2017-05-23 15:28:28">  Additionally, the 'fixity status' line on a FileSet show page now does show actual fixity status, although the display again isn't pretty.