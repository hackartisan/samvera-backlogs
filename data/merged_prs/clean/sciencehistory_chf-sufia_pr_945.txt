integration tests
Closes #466