Only propagate valid states.
Closes #208