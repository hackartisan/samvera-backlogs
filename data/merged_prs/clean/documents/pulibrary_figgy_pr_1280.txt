Merge Valhalla engine with Figgy
Closes #1241