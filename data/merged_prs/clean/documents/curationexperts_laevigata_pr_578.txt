Overall cleanup for issue #496
