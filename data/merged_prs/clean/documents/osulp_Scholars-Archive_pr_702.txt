Refactors duplicate code into behaviors
Fixes #689