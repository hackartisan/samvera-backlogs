Purge the IIIF cache of images when assets change or are removed
Descriptive summary Background This involves our IIIF server's cache, so warrants a bit of explanation here: We store our JP2s in S3, so when the IIIF server needs to serve up tiles for one of them, it has to cache the file locally. RAIS has an S3 plugin for serving images from S3, and part of that plugin handles caching files locally. Via an undocumented feature (which I plan to document once we kick the tires a bit more), we can configure this cache to live for a certain amount of time.  But however long it lives, whether we configure it for 5 minutes, 5 days, or just let it live indefinitely, we need to be able to purge anything cached if the asset's content changes in Oregon Digital. What's needed RAIS provides an endpoint for purging cached data which we can leverage to automate removal of cached items per asset's S3 id.  We will need to be able to translate from a Fedora pid to the asset's S3 id (but we'll need this anyway in order to display images in the first place). We'll need to call this endpoint any time an asset is removed or its has a modified datastream. Expected behavior When...  ...an image is deleted  Ingest an image View it with RAIS (i.e., verify that it's been processed for universal viewer) Delete the image in OD Verify that RAIS purged the image from its cache - this may require a low-level filesystem check   ...an image is modified  Ingest an image View it with RAIS (i.e., verify that it's been processed for universal viewer) Modify the image in OD Verify that RAIS purged the image from its cache - this may require a low-level filesystem check Verify that viewing the new asset in universal viewer doesn't have remnants of the old image   ...a PDF is deleted  Ingest a PDF View all pages with RAIS Delete the PDF in OD Verify that RAIS purged all pages' images from its cache - this may require a low-level filesystem check   ...a PDF is modified  Ingest a PDF View all pages with RAIS Update the PDF in OD Verify that RAIS purged all pages' images from its cache - this may require a low-level filesystem check Verify that all pages are for the new PDF; no remnants of the old cache show up   ...an asset's metadata is changed, but the image or pdf don't change  Ingest an asset (image or PDF) View it with RAIS Update the asset's metadata without changing its image Verify RAIS still has the image cached This scenario may not be a huge priority; worst-case scenario is purging more from our cache than we technically need to    Related work Semi-related to #84
From :  > so when a fileset changes or updates, there should be a job that fires off in the actor stack to tell RAIS to clear its cache